<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>PlastiMaker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link rel="stylesheet" href="../css/fontawesome-free-5.13.1-web/css/all.css" media="screen">
  <link rel="stylesheet" href="../css/bootstrap.min.css" media="screen">
  <link rel="stylesheet" href="../openjscad/min.css" type="text/css">
  <link rel="stylesheet" href="../css/custom.css" media="screen">


</head>

<body>


  <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
    <div class="container">
      <a href="../" class="navbar-brand">PlastiMaker</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="models">3D Printable
              Models<span class="caret"></span></a>
            <div class="dropdown-menu" aria-labelledby="models">
              <a class="dropdown-item" href="#">Mini Drawers</a>
            </div>
          </li>
        </ul>

      </div>
    </div>
  </div>

  <section class="bg-light">
    <div class="container">
      <div class="row">
        <div class="col-xl-8" id="jscadmagic"></div>
        <div class="col-xl-2" id="jscadparts">
          <!-- <div class="part-item">
            <a class="part-link" href="model.html?m=mini-drawers%7Ca%7Cdrawer-001">
              <div class="part-hover">
                <div class="part-hover-content"><i class="fas fa-hand-pointer fa-3x"></i></div>
              </div>
              <img class="img-fluid" src="mini-drawers/img/drawer-400x300.jpg" alt="">
            </a>
          </div>
          <div class="part-text text-center"><strong>Drawers</strong></div> -->
        </div>
      </div>
    </div>
  </section>

  <script src="../js/jquery.min.js"></script>
  <script src="../js/popper.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../openjscad/min.js"></script>

  <script>
    var g_prm_drawer_width = 70;
    var g_prm_drawer_depth = 120;
    var g_prm_drawer_height = 24;
    var g_prm_drawer_thickness = 0.8;
    var g_prm_drawer_numOfSections = 6;//>=1


    $(function () {
      var model = qs('m').split('|');

      $.getJSON(model[0] + '/' + model[1] + '/metadata.json', function (info) {
        document.title = document.title + ': ' + info.title;

        $.each(info.params, function (k, v) {
          window['g_prm_'+k]=v;
        });

        for (var i = 0; i < info.parts.length; i++) {
          $('#jscadparts').append(
            '<div class="part-item">' +
            '<a class="part-link" href="javascript:;" name="' + info.parts[i].name + '">' +
            '<div class="part-hover"><div class="part-hover-content"><i class="fas fa-hand-pointer fa-3x"></i></div></div>' +
            '<img class="img-fluid" src="' + model[0] + '/img/' + info.parts[i].image + '" alt="">' +
            '</a>' +
            '</div>' +
            '<div class="part-text text-center"><strong>' + info.parts[i].title + '</strong></div>');

          $('#jscadparts .part-link').last().on('click', function () {
            if (window['JsCadListeners']) {
              //remove resize listeners to avoid script errors
              $.each(window.JsCadListeners, function (key, value) {
                window.removeEventListener('resize', value);
              });
            }
            loadModel(model[0], model[1], $(this).attr('name'));
          });
        }
        loadModel(model[0], model[1], model[2]);
      });

      function loadModel(model, version, part) {
        var content =
          '<div class="jscad-container jscad-container-custom">' +
          '<div id="header"><div id="errordiv">This should not take too long?!</div></div>' +
          '<div oncontextmenu="return false;" id="viewerContext"></div>' +
          '<div id="tail" style="display: none;"><div id="statusdiv"></div></div>' +
          '</div>';

        $('#jscadmagic').html(content);


        var gProcessor = JsCadInit({
          viewer: {
            camera: {
              position: { x: 0, y: -40, z: 400 },
              clip: { min: 0.5, max: 1000 }
            },
            axis: {
              draw: true
            }
          }
        });

        $.get(model + '/' + version + '/' + part + '.jscad', function (data) {
          gProcessor.setJsCad(data);

          // bind params change
          $('input[type="number"]').bind("change paste keyup", function () {
            var fldName = 'g_prm_' + $(this).attr('name');
            if (window[fldName]!==undefined) {
              window[fldName] = parseFloat($(this).val());
            }
          });
          $('input[type="checkbox"]').change(function() {
            var fldName = 'g_prm_' + $(this).attr('name');
            if (window[fldName]!==undefined) {
              window[fldName] = this.checked;
            }
          });
        });
      }

      function qs(key) {
        key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&");
        var match = location.search.match(new RegExp("[?&]" + key + "=([^&]+)(&|$)"));
        return match && decodeURIComponent(match[1].replace(/\+/g, " "));
      }
    });

  </script>

</body>